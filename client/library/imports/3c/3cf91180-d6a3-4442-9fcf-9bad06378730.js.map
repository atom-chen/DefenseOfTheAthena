{"version":3,"sources":["assets\\script\\framework\\ui\\UIUtil.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import Clog, { ClogKey } from \"../clog/Clog\";\r\nimport { IsNullOrEmpty, CheckNetUrl } from \"../util/StringUtil\";\r\nimport { ResManager } from \"../res/ResManager\";\r\n\r\n\r\n\r\nexport class UIUtil {\r\n\r\n\r\n    //设置玩家头像\r\n    public static SetHeadIcon(iconId: string, iconSprite: cc.Sprite, playerId?: string) {\r\n        if (iconSprite == null) {\r\n            Clog.Error('iconSprite is null ');\r\n            return;\r\n        }\r\n\r\n        iconId = (Number(playerId) % 50).toString();\r\n        //非网络图片为 0~19的字符\r\n        if (IsNullOrEmpty(iconId)) {\r\n            iconId = 'T_HeadIcon_0'\r\n        }\r\n        else {\r\n            iconId = 'T_HeadIcon_' + Number(iconId);\r\n        }\r\n\r\n        this.ChangeSprite(iconId, iconSprite);\r\n    }\r\n\r\n\r\n\r\n    //加载远程图片\r\n    public static LoadRemoteImage(path: string, sprite: cc.Sprite) {\r\n        if (IsNullOrEmpty(path)) {\r\n            Clog.Warn(ClogKey.UI, \"LoadNetImg path error:\" + path);\r\n            return;\r\n        }\r\n\r\n        if (!CheckNetUrl(path)) {\r\n            return;\r\n        }\r\n        Clog.Orange(ClogKey.Net, \"LoadRemoteImage url:\" + path);\r\n\r\n        cc.loader.load({ url: path }, (err, image) => {\r\n            if (err) {\r\n                Clog.Warn(ClogKey.UI, 'LoadNetImg load error,error:' + err);\r\n                return;\r\n            }\r\n            if (sprite.node == null) {\r\n                Clog.Error('LoadNetImg load error>>>>>>>>obj.node==null')\r\n                return;\r\n            }\r\n            let spriteFrame = new cc.SpriteFrame(image);\r\n            sprite.spriteFrame = spriteFrame;\r\n        });\r\n    }\r\n\r\n    //改变图片\r\n    public static ChangeSprite(name: string, sprite: cc.Sprite) {\r\n        if (sprite == null) {\r\n            return;\r\n        }\r\n\r\n        if (IsNullOrEmpty(name)) {\r\n            Clog.Error('ChangeSprite name is Empty!')\r\n            return;\r\n        }\r\n\r\n        if (sprite.spriteFrame != null && sprite.spriteFrame.name == name) {\r\n            return;\r\n        }\r\n\r\n        ResManager.LoadRes(name, cc.SpriteFrame, (error: Error, res: cc.SpriteFrame) => {\r\n            if (error) {\r\n                Clog.Error('ChangeSprite Error!, name:' + name + \",err\" + JSON.stringify(error))\r\n                return;\r\n            }\r\n            let sf = res;\r\n            if (sprite.isValid) {\r\n                sprite.spriteFrame = sf;\r\n            }\r\n        });\r\n    }\r\n\r\n    public static async CreateAnimationClip(name: string): Promise<cc.AnimationClip> {\r\n        return new Promise(resolve => {\r\n            if (IsNullOrEmpty(name)) {\r\n                Clog.Error('CreateAnimationClip name is Empty!')\r\n                resolve(null);\r\n                return;\r\n            }\r\n\r\n            cc.loader.loadResDir(name, cc.SpriteFrame, function (err: Error, spriteFrames: cc.SpriteFrame[], urls: string[]) {\r\n                if (err) {\r\n                    Clog.Error('CreateAnimationClip Error!, name:' + name + \",err\" + JSON.stringify(err));\r\n                    resolve(null);\r\n                    return;\r\n                }\r\n\r\n                let frames = [];\r\n                frames.push(...spriteFrames);\r\n\r\n                // @ts-ignore\r\n                frames.sort((a, b) => {\r\n                    return a.name == b.name ? 0 : a.name < b.name ? -1 : 1;\r\n                });\r\n\r\n                // hack cc.AnimationClip.createWithSpriteFrames(spriteFrames, sample)\r\n                // 参照creator版本2.3.3\r\n                let createWithSpriteFrames = function (spriteFrames: cc.SpriteFrame[], sample: number) {\r\n                    var clip = new cc.AnimationClip();\r\n                    clip.sample = sample || clip.sample;\r\n\r\n                    let frames = [];\r\n                    let duration = 0;\r\n                    for (let i = 0, l = spriteFrames.length; i < l; i++) {\r\n                        let index = spriteFrames[i].name.lastIndexOf('-');\r\n                        let time = parseInt(spriteFrames[i].name.substr(index + 1));\r\n                        frames[i] = { frame: duration, value: spriteFrames[i] };\r\n                        duration += time / 1000;\r\n                    }\r\n\r\n                    // 复制最后一帧，让最后一帧的持续时间有意义\r\n                    frames[spriteFrames.length] = { frame: duration, value: spriteFrames[spriteFrames.length - 1] };\r\n\r\n                    // @ts-ignore\r\n                    clip._duration = duration;\r\n\r\n                    clip.curveData = {\r\n                        comps: {\r\n                            // component\r\n                            'cc.Sprite': {\r\n                                // component properties\r\n                                'spriteFrame': frames\r\n                            }\r\n                        }\r\n                    };\r\n\r\n                    return clip;\r\n                }\r\n\r\n                // resolve(cc.AnimationClip.createWithSpriteFrames(spriteFrames, 30));\r\n                resolve(createWithSpriteFrames(spriteFrames, 30));\r\n            });\r\n        });\r\n    }\r\n\r\n    /**\r\n   * 动态加载龙骨\r\n   * @param animationDisplay  龙骨组件\r\n   * @param name              龙骨地址\r\n   * @param armatureName      Armature名称\r\n   * @param animName          Animation名称\r\n   * @param playTimes         播放次数 -1是根据龙骨文件 0五险循环 >0是播放次数\r\n   */\r\n    public static LoadDragonBones(animationDisplay: dragonBones.ArmatureDisplay, path: string, armatureName: string, animName: string, playTimes = 1): Promise<boolean> {  //动态加载龙骨\r\n\r\n        return new Promise((reslove) => {\r\n            cc.loader.loadResDir(path, (err, assets) => {\r\n\r\n                if (err || assets.length <= 0) {\r\n                    reslove(false)\r\n                    return;\r\n                }\r\n\r\n                assets.forEach(asset => {\r\n                    if (asset instanceof dragonBones.DragonBonesAsset) {\r\n                        animationDisplay.dragonAsset = asset;\r\n                    }\r\n                    if (asset instanceof dragonBones.DragonBonesAtlasAsset) {\r\n                        animationDisplay.dragonAtlasAsset = asset;\r\n                    }\r\n                });\r\n\r\n                animationDisplay.armatureName = armatureName;\r\n                animationDisplay.playAnimation(animName, playTimes);\r\n                animationDisplay.addEventListener(dragonBones.EventObject.COMPLETE, () => {\r\n                    animationDisplay.removeEventListener(dragonBones.EventObject.COMPLETE)\r\n                    reslove(true)\r\n                });\r\n            })\r\n        })\r\n    }\r\n\r\n\r\n}"]}